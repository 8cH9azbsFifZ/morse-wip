	SUBROUTINE KEY(DUR,X)

	DIMENSION ESEP (6),EDEV(6),MORSE(10,40)
	DIMENSION ITEXT(200)

C	DIMENSION IOUTP(500)
C	CHARACTER(500) IOUTP 
	CHARACTER*500 IOUTP

C	DIMENSION ISYMBL(6)
C	CHARACTER*6 ISYMBL
	CHARACTER(LEN=6), PARAMETER :: ISYMBL = '.-^CWP'
	CHARACTER*1 CHR


	COMMON/BLKEND/IEND

	COMMON /BLK1/TAU
	COMMON /BLK6/ DMEAN,XDUR,ESEP,EDEV
	COMMON /BLKTXT/ITEXT

	DATA IEND/0/
	DATA IK/0001000000000/
	DATA LTR/1/,NELM/0/, N/0/, NLTR/1/

	DATA MORSE/1,3,2,0,0,0,0,0,0,0,
     &2,3,1,3,1,3,1,0,0,0,2,3,1,3,2,3,1,0,0,0,
     &2,3,1,3,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
     &1,3,1,3,2,3,1,0,0,0,2,3,2,3,1,0,0,0,0,0,
     &1,3,1,3,1,3,1,0,0,0,1,3,1,0,0,0,0,0,0,0,
     &1,3,2,3,2,3,2,0,0,0,2,3,1,3,2,0,0,0,0,0,
     &1,3,2,3,1,3,1,0,0,0,2,3,2,0,0,0,0,0,0,0,
     &2,3,1,0,0,0,0,0,0,0,2,3,2,3,2,0,0,0,0,0,
     &1,3,2,3,2,3,1,0,0,0,2,3,2,3,1,3,2,0,0,0,
     &1,3,2,3,1,0,0,0,0,0,1,3,1,3,1,0,0,0,0,0,
     &2,0,0,0,0,0,0,0,0,0,1,3,1,3,2,0,0,0,0,0,
     &1,3,1,3,1,3,2,0,0,0,1,3,2,3,2,0,0,0,0,0,
     &2,3,1,3,1,3,2,0,0,0,2,3,1,3,2,3,2,0,0,0,
     &1,3,1,3,2,3,2,3,2,0,1,3,1,3,1,3,2,3,2,0,
     &1,3,1,3,2,3,2,3,2,0,1,3,1,3,1,3,2,3,2,0,
     &1,3,1,3,1,3,1,3,2,0,1,3,1,3,1,3,1,3,1,0,
     &2,3,1,3,1,3,1,3,1,0,2,3,2,3,1,3,1,3,1,0,
     &2,3,2,3,2,3,1,3,1,0,2,3,2,3,2,3,2,3,1,0,
     &2,3,2,3,2,3,2,3,2,0,40*0/

	DATA IELM/1/

C	REPLACE WITH THIS: CHARACTER(LEN=6), PARAMETER :: ISYMBL = '.-^CWP'
C	DATA ISYMBL/'.','-','^','C','W','P'/


	BETA=1000.*TAU*DUR
	IF(BETA .LT. XDUR) GO TO 200
	NELM=NELM+1
	IELM=MORSE(NELM,LTR)
	IF(IELM.NE. 0) GO TO 100
	NELM=0
C	Y=RAND(IK)
	IELM=4
	IF(Y .GT. .9) IELM=5
	IF((Y.LE. .9).AND.(Y.GT. .3)) IELM=6
C	Y=RAND(IK)
C	Y=35*(Y-0.001)+1.
C	IY=Y
C	LTR=IY+1
	LTR = LTR +1
	IF (LTR.GE.36) LTR = 1
	GO TO 100


	NLTR=NLTR+1
	LTR=ITEXT(NLTR)
	IF(LTR .EQ. 0) IELM=4
	IF(LTR .EQ. 37)IELM=5
	IF(LTR .EQ. 38)IELM=6
	NLTR=NLTR+1
	LTR=ITEXT(NLTR)

100	N=N+1
C	TO MAKE COMPATIBLE WITH F2C - REPLACE BELOW WITH THIS 
	IOUTP(N:N+1) = ISYMBL(IELM:IELM+1)
C	IOUTP(N) = ISYMBL(IELM)

	IF(N .LT. 300) GO TO 110
	N=0
	NLTR=0
	IEND=1
	PRINT 90
90	FORMAT(1X,'END OF RUN; INPUT DATA WAS:')

	DO 10 K=1,10
	K1=(K-1)*50+1
	K2=K*50
C	PRINT 105,(IOUTP(L), L=K1,K2)
	PRINT 105,IOUTP(K1:K2)
105	FORMAT(1X,A50)
10	CONTINUE

	READ 105,WAIT

110	XM=ESEP(IELM)*DMEAN
	XSIGM=EDEV(IELM)*DMEAN
C	Y=RAND(IK)
C	Y=2.*(Y-.5)
C	XDUR=XM+Y+XSIGM
	XDUR = XM + XSIGM
	IF(XDUR .LT. 20.) XDUR=20.
C	MARK x=1  SPACE x=0
	X=1.
	IF(IELM .GE. 3) X=0

200	CONTINUE
C	PRINT 300, NELM, LTR, IELM, XM, BETA, XDUR
C300	FORMAT('KEY: ',3(I3,2X),3(F8.2,2X))
	RETURN
	END
